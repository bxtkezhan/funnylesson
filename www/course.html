<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width" />
        <title>Course</title>
    </head>
    <style type="text/css" media="screen">
        table, th, td {
            border: 1px solid black;
        }
    </style>
    <body>
        <h1>Course</h1>
        <ol id="course">
        </ol>
        <table id="lessons" style="width:100%">
            <tr>
                <th>ID</th>
                <th>Time</th>
                <th>Title</th>
                <th>Introduction</th>
                <th>Image</th>
                <th>Level</th>
            </tr>
        </table> 
    </body>
</html>

<script charset="utf-8">
// type Course struct {
//     Id int
//     Time int64
//     Title string
//     Introduction string
//     Keywords string
//     Image string
//     Category string
//     Owner int
//     Total int
//     Level int
// }
window.onload = async function() {
    var id = await loadCourse();
    loadLessons(id);
};

async function loadCourse() {
    var columns = [
        "Id", "Time", "Title", "Introduction", "Keywords",
        "Image", "Category", "Total", "Owner", "Level"];
    const resp = await fetch(`/api/course${window.location.search}`);
    var course = await resp.json();
    var list = document.querySelector("#course");
    var id = 0;
    for (var i = 0; i < columns.length; ++i) {
        var column = columns[i];
        if (column == "Id") id = course[column];
        var li = document.createElement("li");
        li.innerText = `${column}: ${course[column]}`;
        list.appendChild(li);
    }
    return id;
}

async function loadLessons(id) {
    var columns = ["Id", "Time", "Title", "Introduction", "Image", "Level"];
    const resp = await fetch(`/api/contents?id=${id}`);
    var lessons = await resp.json();
    var table = document.querySelector("#lessons");
    lessons.forEach(user => {
        var tr = document.createElement("tr");
        for (var i = 0; i < columns.length; ++i) {
            var td = document.createElement("td");
            td.innerText = user[columns[i]];
            tr.appendChild(td);
        }
        table.appendChild(tr);
    });
}
</script>
