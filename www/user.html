<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width" />
        <link rel="stylesheet" href="/css/basic.css" type="text/css">
        <title>User</title>
    </head>
    <style type="text/css" media="screen">
        table, th, td {
            border: 1px solid black;
        }
    </style>
    <body>
        <nav id="menu" class="menu"></nav>
        <main>
            <section>
                <div class="container user">
                    <img id="user-picture"></img>
                    <div id="user-profile" class="profile">
                        <label>用戶名</label>
                        <p f-name="Username"></p>
                        <small>#</small><small f-name="Id"></small>
                        <hr>
                        <label>電子郵箱</label>
                        <p f-name="Email"></p>
                        <hr>
                        <label>身份</label>
                        <p f-name="Level" f-switch="普通;VIP;員工;管理員"></p>
                        <hr>
                        <label>個人簡介</label>
                        <p f-name="Introduction"></p>
                        <hr>
                        <label>註冊時間</label>
                        <time f-name="Time"></time>
                    </div>
                </div>
            </section>
            <section>
                <header>訂閱課程</header>
                <div class="container gallery">
                    <div id="course">
                        <img f-name="Image" f-onclick="Id"/>
                        <header f-name="Title" f-onclick="Id"></header>
                        <summary f-name="Introduction"></summary>
                        <time f-name="Time" style="float: right"></time>
                    </div>
                </div>
            </section>
        </main>
        <a id="goto" class="goto-btn" onclick="window.scrollTo(0, 0);">
            <img src="/icon/down-chevron.png" alt=""/>
        </a>
        <center id="loading"></center>
        <footer></footer>
    </body>
</html>
<script src="/js/functions.js" charset="utf-8"></script>
<script charset="utf-8">
// type User struct {
//     Id int
//     Username string
//     - Password string
//     Email string
//     Introduction string
//     Image string
//     Time int
//     Level string
// }

window.onload = function() {
    var main = document.querySelector("main");
    var footer = document.querySelector("footer");
    const main_top = main.getBoundingClientRect().top;
    const footer_height = footer.getBoundingClientRect().height;
    main.style.minHeight = window.innerHeight - main_top - footer_height + 'px';

    render_user();
    render_likes();
};

window.onscroll = function() {
    var navbar = document.querySelector('nav');
    var bottom = navbar.getBoundingClientRect().bottom;
    if (bottom < 0) {
        document.querySelector('#goto').style.visibility = 'visible';
    } else {
        document.querySelector('#goto').style.visibility = 'hidden';
    }
}

async function render_user() {
    const user = await load_user();
    var columns = document.querySelector('#user-profile').children;
    extend_columns(user, columns, null);
    document.querySelector('#user-picture').src = `https://avatars.dicebear.com/api/big-smile/${user.Username}.svg`;
    create_menu('#menu', [{href: '/courses.html', text: '課程'}]);
};

async function render_likes() {
    set_loading('#loading');
    var data = await load_likes();
    del_loading('#loading');
    var nodes = select_template('#course');
    extend_items(data, nodes.tpl, nodes.ptr, function(id) {
        location.href = `/course.html?id=${id}`;
    });
};
</script>
