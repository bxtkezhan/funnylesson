<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width" />
        <link rel="stylesheet" href="/css/basic.css" type="text/css">
        <title>User</title>
    </head>
    <style type="text/css" media="screen">
        table, th, td {
            border: 1px solid black;
        }
    </style>
    <body>
        <nav class="menu">
            <a class="menu-logo" href="/">
                <img src="/logo/studydou.png"/>
            </a>
            <a class="menu-title" href="/">Studydou</a>
            <a class="menu-item" href="/courses.html">課程</a>
            <a class="menu-item" href="/">首頁</a>
        </nav>
        <main>
            <section>
                <ol id="user">
                </ol>
                <table id="courses" style="width:100%">
                    <tr>
                        <th>ID</th>
                        <th>Time</th>
                        <th>Title</th>
                        <th>Introduction</th>
                        <th>Image</th>
                        <th>Level</th>
                    </tr>
                </table> 
            </section>
        </main>
        <a id="goto" class="goto-btn" onclick="window.scrollTo(0, 0);">
            <img src="/icon/down-chevron.png" alt=""/>
        </a>
        <center id="loading"></center>
        <footer></footer>
    </body>
</html>

<script charset="utf-8">
// type User struct {
//     Id int
//     Username string
//     - Password string
//     Email string
//     Introduction string
//     Image string
//     Time int
//     Level string
// }
window.onload = function() {
    var main = document.querySelector("main");
    var footer = document.querySelector("footer");
    const main_top = main.getBoundingClientRect().top;
    const footer_height = footer.getBoundingClientRect().height;
    main.style.minHeight = window.innerHeight - main_top - footer_height + 'px';

    loadUser();
    loadLikes();
};

async function loadUser() {
    var columns = ["Id", "Username", "Email", "Introduction", "Image", "Time", "Level"];
    const resp = await fetch(`/api/user${window.location.search}`);
    var user = await resp.json();
    var list = document.querySelector("#user");
    for (var i = 0; i < columns.length; ++i) {
        var column = columns[i];
        var li = document.createElement("li");
        li.innerText = `${column}: ${user[column]}`;
        list.appendChild(li);
    }
};

async function loadLikes() {
    var columns = ["Id", "Time", "Title", "Introduction", "Image", "Level"];
    const resp = await fetch(`/api/likes`);
    var courses = await resp.json();
    var table = document.querySelector("#courses");
    courses.forEach(course => {
        var tr = document.createElement("tr");
        for (var i = 0; i < columns.length; ++i) {
            var td = document.createElement("td");
            td.innerText = course[columns[i]];
            tr.appendChild(td);
        }
        table.appendChild(tr);
    });
};
</script>
